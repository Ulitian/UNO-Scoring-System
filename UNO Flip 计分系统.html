<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Flip! è®¡åˆ†ç³»ç»Ÿ | iOSæ¶²æ€ç»ç’ƒç‰ˆ</title>
    <style>
        /* å…¨å±€åŸºç¡€æ ·å¼ - è‹¹æ–¹å­—ä½“+iOSé£æ ¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* è‹¹æœè‹¹æ–¹å­—ä½“ä¼˜å…ˆçº§ï¼šSF Pro > è‹¹æ–¹ > åå¤‡å­—ä½“ */
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "SF Pro SC", "SF Pro Text", "SF Pro Icons", "HanHei SC", "Helvetica Neue", Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* iOSé£æ ¼èƒŒæ™¯ - æ¸å˜+å™ªç‚¹çº¹ç† */
        body {
            background: linear-gradient(135deg, #f0f4f8 0%, #e8eef2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            font-weight: 400;
            font-size: 16px;
            color: #1d1d1f;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
            z-index: -1;
            pointer-events: none;
        }

        /* ä¸»å®¹å™¨ - æ¶²æ€ç»ç’ƒæ ¸å¿ƒæ ·å¼ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.08),
                0 1px 2px rgba(0, 0, 0, 0.05);
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        /* æ ‡é¢˜æ ·å¼ - è‹¹æ–¹ç²—ä½“+iOSé—´è· */
        h1 {
            color: #1d1d1f;
            text-align: center;
            margin-bottom: 32px;
            font-size: 32px;
            font-weight: 700; /* è‹¹æ–¹ç²—ä½“ */
            letter-spacing: -0.5px;
            position: relative;
            font-family: "PingFang SC", "SF Pro Display", sans-serif;
        }
        h1::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, #ff3b30, #ff9500);
            border-radius: 2px;
            margin: 12px auto 0;
        }

        h2 {
            color: #1d1d1f;
            font-size: 20px;
            font-weight: 600; /* è‹¹æ–¹åŠç²—ä½“ */
            margin-bottom: 20px;
            letter-spacing: -0.3px;
            font-family: "PingFang SC", "SF Pro Display", sans-serif;
        }

        h3 {
            color: #1d1d1f;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: -0.2px;
            font-family: "PingFang SC", "SF Pro Display", sans-serif;
        }

        /* æ¸¸æˆè®¾ç½®åŒºåŸŸ - æ¶²æ€ç»ç’ƒå­å®¹å™¨ */
        .setup-section {
            margin-bottom: 36px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 18px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }

        /* ç©å®¶äººæ•°é€‰æ‹© */
        .player-count {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .player-count label {
            font-size: 16px;
            color: #1d1d1f;
            font-weight: 500; /* è‹¹æ–¹ä¸­ç²—ä½“ */
            font-family: "PingFang SC", sans-serif;
        }
        .player-count select {
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            min-width: 120px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%231d1d1f' d='M10.8 1.2L6 6 1.2 1.2A1 1 0 012.6 0l4 4 4-4a1 1 0 011.4 1.4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            transition: all 0.2s ease;
            font-family: "PingFang SC", sans-serif;
            font-weight: 400;
        }
        .player-count select:hover {
            border-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* ç©å®¶ä¿¡æ¯è®¾ç½®åŒºåŸŸ - æ¶²æ€ç»ç’ƒæ ·å¼ */
        .player-info-setup {
            margin-top: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 18px;
            display: none;
        }

        /* ç©å®¶ä¿¡æ¯é¡¹ - å½»åº•ä¿®å¤å¤´åƒæ ·å¼ */
        .player-info-item {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            gap: 16px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
        }
        /* åŸºç¡€å¤´åƒæ ·å¼ï¼ˆç»Ÿä¸€å¤ç”¨ï¼‰ */
        .base-avatar {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-family: "PingFang SC", sans-serif;
        }
        /* è®¾ç½®é¡µå¤´åƒ */
        .setup-avatar {
            width: 48px;
            height: 48px;
            font-size: 18px;
        }
        /* è®¡åˆ†å¡å¤´åƒ */
        .card-avatar {
            width: 36px;
            height: 36px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .player-info-inputs {
            flex: 1;
        }
        .player-info-inputs input[type="text"] {
            padding: 12px 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            font-size: 16px;
            width: 200px;
            margin-right: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            font-family: "PingFang SC", sans-serif;
            font-weight: 400;
        }
        .player-info-inputs input[type="text"]:focus {
            outline: none;
            border-color: #ff3b30;
            box-shadow: 0 0 0 4px rgba(255, 59, 48, 0.1);
        }
        .avatar-upload {
            font-size: 13px;
            color: #86868b;
            cursor: pointer;
            transition: color 0.2s ease;
            font-family: "PingFang SC", sans-serif;
        }
        .avatar-upload:hover {
            color: #ff3b30;
        }
        input[type="file"] {
            display: none;
        }

        /* iOSé£æ ¼æŒ‰é’® - æ¶²æ€ç»ç’ƒ+æ¸å˜ */
        button {
            background: linear-gradient(135deg, #ff3b30, #ff9500);
            color: white;
            border: none;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 16px rgba(255, 59, 48, 0.2);
            font-family: "PingFang SC", "SF Pro Display", sans-serif;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 59, 48, 0.3);
            background: linear-gradient(135deg, #ff2d20, #ff8c00);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(255, 59, 48, 0.2);
        }

        /* è®¡åˆ†åŒºåŸŸ */
        .score-section {
            display: none;
            margin-top: 36px;
        }

        /* ç©å®¶è®¡åˆ†å¡ç‰‡ - æ¶²æ€ç»ç’ƒç½‘æ ¼ */
        .player-score-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        .player-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }
        .player-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }
        .player-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .player-card h3 {
            color: #1d1d1f;
            margin: 0;
            font-size: 18px;
        }

        /* åˆ†æ•°æ˜¾ç¤º */
        .current-score {
            font-size: 28px;
            font-weight: 700;
            color: #ff3b30;
            margin: 16px 0;
            letter-spacing: -0.5px;
            font-family: "PingFang SC", sans-serif;
        }
        .card-points {
            margin-bottom: 16px;
        }
        .card-points label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #86868b;
            font-weight: 500;
            font-family: "PingFang SC", sans-serif;
        }
        .card-points input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            font-size: 16px;
            transition: all 0.2s ease;
            font-family: "PingFang SC", sans-serif;
            font-weight: 400;
        }
        .card-points input:focus {
            outline: none;
            border-color: #ff3b30;
            box-shadow: 0 0 0 4px rgba(255, 59, 48, 0.1);
        }

        /* è½®æ¬¡æ§åˆ¶æŒ‰é’® */
        .round-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 24px;
            gap: 16px;
        }
        .round-controls button {
            flex: 1;
            text-align: center;
        }

        /* å†å²è®°å½•åŒºåŸŸ */
        .round-history {
            margin-top: 36px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 18px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 12px;
            overflow: hidden;
            font-family: "PingFang SC", sans-serif;
        }
        .history-table th {
            padding: 16px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            color: #1d1d1f;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .history-table td {
            padding: 16px;
            text-align: center;
            color: #1d1d1f;
            font-size: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
            font-weight: 400;
        }
        .history-table tr:last-child td {
            border-bottom: none;
        }
        .history-table tr:hover td {
            background: rgba(255, 59, 48, 0.03);
        }

        /* è·èƒœæç¤º - iOSé£æ ¼å¼¹çª— */
        .winner-alert {
            background: linear-gradient(135deg, #34c759, #30d158);
            color: white;
            padding: 24px;
            border-radius: 18px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            margin-top: 24px;
            display: none;
            box-shadow: 0 8px 24px rgba(52, 199, 89, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            font-family: "PingFang SC", sans-serif;
        }

        /* è§„åˆ™æç¤º - æ¶²æ€ç»ç’ƒä¾§è¾¹æ  */
        .rules-tip {
            margin-top: 36px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-left: 4px solid #007aff;
            border-radius: 18px;
            font-size: 14px;
            color: #1d1d1f;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            font-family: "PingFang SC", sans-serif;
        }
        .rules-tip h3 {
            margin-bottom: 12px;
            color: #007aff;
            font-size: 16px;
        }
        .rules-tip ul {
            margin-left: 20px;
            line-height: 1.8;
            color: #424245;
            font-weight: 400;
        }
        .rules-tip li {
            margin-bottom: 8px;
        }

        /* å“åº”å¼é€‚é… - ç§»åŠ¨ç«¯iOSé£æ ¼ */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
            .container {
                padding: 24px;
                border-radius: 20px;
            }
            .player-score-cards {
                grid-template-columns: 1fr;
            }
            .round-controls {
                flex-direction: column;
            }
            .player-info-inputs input[type="text"] {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>UNO Flip! è®¡åˆ†ç³»ç»Ÿ</h1>

        <!-- æ¸¸æˆè®¾ç½®åŒºåŸŸ -->
        <div class="setup-section">
            <h2>æ¸¸æˆè®¾ç½®</h2>
            <div class="player-count">
                <label for="playerNumber">é€‰æ‹©ç©å®¶äººæ•°ï¼š</label>
                <select id="playerNumber">
                    <option value="2">2äºº</option>
                    <option value="3">3äºº</option>
                    <option value="4">4äºº</option>
                    <option value="5">5äºº</option>
                    <option value="6">6äºº</option>
                </select>
            </div>
            <button id="setupPlayers">è®¾ç½®ç©å®¶ä¿¡æ¯</button>
            
            <!-- ç©å®¶ä¿¡æ¯è®¾ç½®åŒºåŸŸ -->
            <div class="player-info-setup" id="playerInfoSetup">
                <h3>ç©å®¶ä¿¡æ¯è®¾ç½®</h3>
                <div id="playerInfoItems"></div>
                <button id="startGame" style="margin-top: 16px;">å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>

        <!-- è®¡åˆ†åŒºåŸŸï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="score-section" id="scoreSection">
            <h2>æœ¬è½®è®¡åˆ†</h2>
            <div class="player-score-cards" id="playerCards"></div>

            <div class="round-controls">
                <button id="calculateRound">è®¡ç®—æœ¬è½®å¾—åˆ†</button>
                <button id="resetGame">é‡ç½®æ¸¸æˆ</button>
            </div>

            <!-- è·èƒœæç¤º -->
            <div class="winner-alert" id="winnerAlert"></div>

            <!-- å†å²è®°å½• -->
            <div class="round-history">
                <h2>æ¸¸æˆå†å²è®°å½•</h2>
                <table class="history-table" id="historyTable">
                    <thead id="historyHeader"></thead>
                    <tbody id="historyBody"></tbody>
                </table>
            </div>
        </div>

        <!-- è§„åˆ™æç¤º -->
        <div class="rules-tip">
            <h3>UNO Flip! è®¡åˆ†è§„åˆ™</h3>
            <ul>
                <li>æ•°å­—ç‰Œï¼ˆ0-9ï¼‰ï¼šå¯¹åº”æ•°å­—åˆ†å€¼ï¼ˆå¦‚7åˆ†ç‰Œå¾—7åˆ†ï¼‰</li>
                <li>åŸºç¡€åŠŸèƒ½ç‰Œï¼ˆåè½¬/è·³è¿‡/+2ï¼‰ï¼šå•é¢10åˆ† | åŒé¢20åˆ†</li>
                <li>ä¸‡èƒ½ç‰Œï¼ˆå˜è‰²/+5ï¼‰ï¼šå•é¢20åˆ† | åŒé¢40åˆ†</li>
                <li>ä¸‡èƒ½+5æ¢è‰²ç‰Œï¼šå•é¢50åˆ† | åŒé¢60åˆ†</li>
                <li>æ¯è½®èµ¢å®¶è·å¾—å…¶ä»–ç©å®¶æ‰‹ä¸­æ‰€æœ‰ç‰Œçš„æ€»åˆ†ï¼Œå…ˆè¾¾500åˆ†è·èƒœ</li>
            </ul>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let playerCount = 2;
        let players = [];
        let roundNumber = 0;
        let gameWon = false;
        // iOSé£æ ¼å¤´åƒæ¸å˜è‰²ï¼ˆç‹¬ç«‹å­˜å‚¨ï¼Œé¿å…æ ·å¼ä¼ é€’é—®é¢˜ï¼‰
        const avatarGradients = [
            'linear-gradient(135deg, #ff3b30, #ff9500)',
            'linear-gradient(135deg, #007aff, #5ac8fa)',
            'linear-gradient(135deg, #34c759, #30d158)',
            'linear-gradient(135deg, #af52de, #bf5af2)',
            'linear-gradient(135deg, #ff2d55, #ff375f)',
            'linear-gradient(135deg, #ffcc00, #ffd633)'
        ];

        // DOMå…ƒç´ 
        const playerNumberSelect = document.getElementById('playerNumber');
        const setupPlayersBtn = document.getElementById('setupPlayers');
        const playerInfoSetup = document.getElementById('playerInfoSetup');
        const playerInfoItems = document.getElementById('playerInfoItems');
        const startGameBtn = document.getElementById('startGame');
        const scoreSection = document.getElementById('scoreSection');
        const playerCards = document.getElementById('playerCards');
        const calculateRoundBtn = document.getElementById('calculateRound');
        const resetGameBtn = document.getElementById('resetGame');
        const winnerAlert = document.getElementById('winnerAlert');
        const historyHeader = document.getElementById('historyHeader');
        const historyBody = document.getElementById('historyBody');

        // ç»‘å®šäº‹ä»¶
        setupPlayersBtn.addEventListener('click', showPlayerInfoSetup);
        startGameBtn.addEventListener('click', initGame);
        calculateRoundBtn.addEventListener('click', calculateRoundScores);
        resetGameBtn.addEventListener('click', resetGame);

        // æ˜¾ç¤ºç©å®¶ä¿¡æ¯è®¾ç½®é¢æ¿ - é‡æ„å¤´åƒåˆ›å»ºé€»è¾‘
        function showPlayerInfoSetup() {
            playerCount = parseInt(playerNumberSelect.value);
            playerInfoItems.innerHTML = '';
            
            // ç”Ÿæˆæ¯ä¸ªç©å®¶çš„ä¿¡æ¯è¾“å…¥é¡¹
            for (let i = 0; i < playerCount; i++) { // æ”¹ç”¨0ç´¢å¼•ï¼Œé¿å…idæ··ä¹±
                const gradient = avatarGradients[i];
                const playerId = i + 1;
                const initial = `P${playerId}`; // é»˜è®¤é¦–å­—æ¯P1/P2...
                
                const infoItem = document.createElement('div');
                infoItem.className = 'player-info-item';
                // ç‹¬ç«‹è®¾ç½®å¤´åƒæ ·å¼ï¼Œä½¿ç”¨åŸºç¡€ç±»+æ¸å˜
                infoItem.innerHTML = `
                    <div class="base-avatar setup-avatar" style="${gradient}" id="setupAvatar${playerId}">${initial}</div>
                    <div class="player-info-inputs">
                        <input type="text" id="playerName${playerId}" placeholder="è¾“å…¥ç©å®¶${playerId}å§“å" value="ç©å®¶${playerId}">
                        <label for="avatarUpload${playerId}" class="avatar-upload">ä¸Šä¼ å¤´åƒ</label>
                        <input type="file" id="avatarUpload${playerId}" accept="image/png, image/jpeg" onchange="uploadAvatar(${playerId})">
                    </div>
                `;
                playerInfoItems.appendChild(infoItem);
            }
            
            // æ˜¾ç¤ºç©å®¶ä¿¡æ¯è®¾ç½®åŒºåŸŸ
            playerInfoSetup.style.display = 'block';
        }

        // ä¸Šä¼ å¤´åƒï¼ˆé¢„è§ˆï¼‰- å½»åº•é‡æ„ï¼Œé¿å…æ ·å¼è¦†ç›–
        function uploadAvatar(playerId) {
            const fileInput = document.getElementById(`avatarUpload${playerId}`);
            const avatarElement = document.getElementById(`setupAvatar${playerId}`);
            
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // ä¿ç•™åŸºç¡€å¤´åƒæ ·å¼ï¼Œä»…æ›¿æ¢èƒŒæ™¯ä¸ºå›¾ç‰‡
                    avatarElement.style.cssText = `
                        width: 48px;
                        height: 48px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: 700;
                        color: white;
                        overflow: hidden;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                        font-family: "PingFang SC", sans-serif;
                        font-size: 18px;
                        background: url(${e.target.result}) center/cover no-repeat;
                    `;
                    avatarElement.innerHTML = ''; // æ¸…ç©ºé¦–å­—æ¯
                }
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆå‡½æ•° - é‡æ„ç©å®¶æ•°æ®å­˜å‚¨
        function initGame() {
            // æ”¶é›†ç©å®¶ä¿¡æ¯
            players = [];
            for (let i = 1; i <= playerCount; i++) {
                const nameInput = document.getElementById(`playerName${i}`);
                const avatarElement = document.getElementById(`setupAvatar${i}`);
                const playerName = nameInput.value.trim() || `ç©å®¶${i}`;
                const firstChar = playerName.charAt(0); // æå–å§“åé¦–å­—æ¯
                // åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡å¤´åƒï¼ˆé€šè¿‡èƒŒæ™¯æ ·å¼åˆ¤æ–­ï¼‰
                const isImageAvatar = avatarElement.style.background.includes('url(');
                // å­˜å‚¨æ ¸å¿ƒä¿¡æ¯ï¼Œè€Œéå®Œæ•´æ ·å¼ï¼ˆé¿å…ä¼ é€’é”™è¯¯ï¼‰
                players.push({
                    id: i,
                    name: playerName,
                    gradient: avatarGradients[i-1], // å­˜å‚¨æ¸å˜å€¼
                    isImageAvatar: isImageAvatar,
                    avatarImage: isImageAvatar ? avatarElement.style.background : '', // ä»…å­˜å›¾ç‰‡èƒŒæ™¯
                    firstChar: firstChar,
                    totalScore: 0,
                    roundPoints: 0
                });
            }
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            roundNumber = 0;
            gameWon = false;
            winnerAlert.style.display = 'none';
            
            // æ¸²æŸ“ç©å®¶è®¡åˆ†å¡ç‰‡
            renderPlayerCards();
            
            // åˆå§‹åŒ–å†å²è®°å½•è¡¨æ ¼
            initHistoryTable();
            
            // æ˜¾ç¤ºè®¡åˆ†åŒºåŸŸï¼Œéšè—è®¾ç½®åŒºåŸŸ
            scoreSection.style.display = 'block';
            playerInfoSetup.style.display = 'none';
        }

        // æ¸²æŸ“ç©å®¶è®¡åˆ†å¡ç‰‡ - å®Œå…¨é‡æ„ï¼Œç¡®ä¿å¤´åƒ100%æ˜¾ç¤º
        function renderPlayerCards() {
            playerCards.innerHTML = '';
            
            players.forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card';
                
                // å•ç‹¬æ„å»ºå¤´åƒHTMLï¼Œé¿å…æ ·å¼æ‹¼æ¥é”™è¯¯
                let avatarHtml = '';
                if (player.isImageAvatar) {
                    // å›¾ç‰‡å¤´åƒï¼šä½¿ç”¨å­˜å‚¨çš„å›¾ç‰‡èƒŒæ™¯ + å¡ç‰‡å¤´åƒå°ºå¯¸
                    avatarHtml = `<div class="base-avatar card-avatar" style="${player.avatarImage}"></div>`;
                } else {
                    // é»˜è®¤å¤´åƒï¼šä½¿ç”¨æ¸å˜ + å§“åé¦–å­—æ¯
                    avatarHtml = `<div class="base-avatar card-avatar" style="${player.gradient}">${player.firstChar}</div>`;
                }
                
                // æ„å»ºå¡ç‰‡å†…å®¹
                card.innerHTML = `
                    <div class="player-card-header">
                        ${avatarHtml}
                        <h3>${player.name}</h3>
                    </div>
                    <div class="current-score">æ€»åˆ†: ${player.totalScore}</div>
                    <div class="card-points">
                        <label for="player${player.id}Points">æœ¬è½®æ‰‹ç‰Œæ€»åˆ†ï¼š</label>
                        <input type="number" id="player${player.id}Points" 
                               value="0" min="0" placeholder="è¾“å…¥åˆ†æ•°">
                    </div>
                `;
                playerCards.appendChild(card);
            });
        }

        // åˆå§‹åŒ–å†å²è®°å½•è¡¨æ ¼
        function initHistoryTable() {
            // åˆ›å»ºè¡¨å¤´
            let headerHtml = '<tr><th>è½®æ¬¡</th>';
            players.forEach(player => {
                headerHtml += `<th>${player.name} å¾—åˆ†</th>`;
            });
            headerHtml += '<th>æœ¬è½®èµ¢å®¶</th></tr>';
            historyHeader.innerHTML = headerHtml;
            
            // æ¸…ç©ºè¡¨æ ¼å†…å®¹
            historyBody.innerHTML = '';
        }

        // è®¡ç®—æœ¬è½®å¾—åˆ†
        function calculateRoundScores() {
            if (gameWon) return;
            
            roundNumber++;
            
            // è·å–æœ¬è½®å„ç©å®¶çš„æ‰‹ç‰Œåˆ†æ•°
            let totalRoundPoints = 0;
            players.forEach(player => {
                const pointsInput = document.getElementById(`player${player.id}Points`);
                player.roundPoints = parseInt(pointsInput.value) || 0;
                totalRoundPoints += player.roundPoints;
                // é‡ç½®è¾“å…¥æ¡†
                pointsInput.value = 0;
            });
            
            // æ‰¾åˆ°æœ¬è½®æ‰‹ç‰Œåˆ†æ•°ä¸º0çš„ç©å®¶ï¼ˆèµ¢å®¶ï¼‰
            const winner = players.find(p => p.roundPoints === 0);
            
            if (!winner) {
                alert('è¯·é€‰æ‹©æœ¬è½®èµ¢å®¶ï¼ˆèµ¢å®¶æ‰‹ç‰Œåˆ†æ•°åº”ä¸º0ï¼‰ï¼');
                roundNumber--;
                return;
            }
            
            // ç»™èµ¢å®¶åŠ åˆ†
            winner.totalScore += totalRoundPoints;
            
            // æ›´æ–°ç©å®¶è®¡åˆ†å¡ç‰‡
            renderPlayerCards();
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(winner, totalRoundPoints);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰äººè¾¾åˆ°500åˆ†è·èƒœ
            checkWinner();
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(winner, totalRoundPoints) {
            const row = document.createElement('tr');
            let rowHtml = `<td>ç¬¬${roundNumber}è½®</td>`;
            
            players.forEach(player => {
                rowHtml += `<td>${player === winner ? totalRoundPoints : 0}</td>`;
            });
            
            rowHtml += `<td>${winner.name}</td>`;
            row.innerHTML = rowHtml;
            historyBody.appendChild(row);
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰ç©å®¶è·èƒœ
        function checkWinner() {
            const winner = players.find(p => p.totalScore >= 500);
            
            if (winner) {
                gameWon = true;
                winnerAlert.textContent = `ğŸ‰ æ­å–œ ${winner.name} è·èƒœï¼æœ€ç»ˆå¾—åˆ†ï¼š${winner.totalScore} åˆ† ğŸ‰`;
                winnerAlert.style.display = 'block';
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            scoreSection.style.display = 'none';
            playerNumberSelect.value = '2';
            playerInfoSetup.style.display = 'none';
            winnerAlert.style.display = 'none';
            playerInfoItems.innerHTML = '';
        }
    </script>
</body>
</html>
